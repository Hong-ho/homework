# 智能菜谱生成系统 - 架构设计文档

---

## 1. 引言

### 1.1 文档目的

本架构设计文档旨在为智能菜谱生成系统提供系统级技术蓝图，指导开发、测试、部署等各阶段工作，确保项目的可扩展性、可维护性及高可用性。

### 1.2 项目概述

本系统是一个基于AI技术的菜谱生成平台，用户可通过输入食材和选择风格自动生成详细菜谱，并为每一步提供图示和最终成品图。

---

## 2. 系统架构概览

### 2.1 架构风格

- **前后端分离架构（Frontend-Backend Separation）**
- **RESTful API接口通信**
- **微服务结构（可演进）**

### 2.2 总体架构图（示意）

```
[前端客户端] <--> [Flask/FastAPI后端服务] <--> [AI生成模块] <--> [图像生成服务]
                                  |
                           [数据库（用户/历史）]
```

---

## 3. 模块划分

| 模块名         | 描述                                                                 |
|----------------|----------------------------------------------------------------------|
| 前端模块       | 用户交互界面，输入原料/风格、显示生成菜谱及图像，支持移动端适配    |
| API服务模块    | 提供统一REST API，包括请求路由、权限认证、数据格式校验              |
| AI生成模块     | 与语言模型交互，完成食谱文本结构化生成                              |
| 图像生成模块   | 调用图像模型，为步骤/成品生成图像（DALL·E 或 SD）                   |
| 用户管理模块   | 管理用户身份、偏好、历史记录等                                       |
| 数据存储模块   | 存储菜谱数据、图像Base64编码、用户历史、缓存信息等                   |

---

## 4. 技术栈

| 层级     | 技术/框架             |
|----------|------------------------|
| 前端     | HTML, CSS, JavaScript, Vue.js / React |
| 后端     | Python, Flask / FastAPI |
| 数据库   | SQLite / PostgreSQL    |
| AI模型   | OpenAI GPT-4 / 自训练模型 |
| 图像生成 | DALL·E / Stable Diffusion |
| 工具链   | Git, Docker, pytest, PWA, JWT |

---

## 5. 接口设计（核心API）

| 方法 | 路径               | 描述                   | 请求参数              | 返回格式     |
|------|--------------------|------------------------|------------------------|--------------|
| POST | `/generate`        | 生成菜谱及图像         | `ingredients`, `style` | JSON + 图片   |
| GET  | `/history`         | 获取用户历史记录       | `user_id`              | JSON         |
| POST | `/export`          | 导出菜谱               | `recipe_id`            | File（PDF/JSON） |
| POST | `/edit_recipe`     | 修改生成后的菜谱内容   | `recipe_id`, `changes` | JSON         |
| POST | `/nutrition`       | 获取营养分析信息       | `recipe_id`            | JSON         |

---

## 6. 数据流说明

1. 用户在前端输入原料与风格 → 请求发送至后端；
2. 后端请求AI模块生成结构化菜谱文本；
3. 菜谱步骤被送至图像模块生成步骤图和成品图；
4. 所有数据封装为JSON格式返回前端；
5. 同时记录至数据库，供历史查看/导出使用。

---

## 7. 数据库设计概要

### 表：User

| 字段       | 类型     | 描述             |
|------------|----------|------------------|
| user_id    | STRING   | 用户唯一标识     |
| username   | STRING   | 用户名           |
| history    | JSON     | 菜谱历史记录引用 |
| preferences| JSON     | 偏好设置         |

### 表：RecipeHistory

| 字段        | 类型   | 描述                   |
|-------------|--------|------------------------|
| recipe_id   | STRING | 唯一菜谱ID             |
| user_id     | STRING | 所属用户ID             |
| ingredients | JSON   | 原料列表               |
| style       | STRING | 菜系风格               |
| steps       | JSON   | 步骤结构化数据         |
| images      | JSON   | Base64图像数据         |
| timestamp   | DATETIME | 创建时间             |

---

## 8. 第三方服务依赖

| 服务名称   | 用途                     | 说明                         |
|------------|--------------------------|------------------------------|
| OpenAI API | 菜谱文本生成             | GPT-4                        |
| SD/DALL·E  | 步骤图和成品图生成       | 本地或云端部署               |
| JWT Auth   | 用户身份认证             | Token-based鉴权             |
| Docker     | 环境统一与部署打包       | 跨平台一致性                |

---

## 9. 安全与容错机制

- 所有输入数据进行严格校验与转义，防止注入攻击；
- 使用 JWT 鉴权机制限制非法访问；
- 图像/AI内容审核接口预留，避免生成敏感内容；
- 所有模块异常均捕获并统一错误响应，防止崩溃；
- 每次请求结果写入日志，便于追踪与调试。

---

## 10. 部署与运行建议

- 使用 Docker 容器部署后端与AI服务；
- 前后端可部署在同一服务器或通过Nginx代理；
- 推荐部署在云平台（如腾讯云、阿里云）以支持负载扩展；
- 可配置 CDN 加速图像加载与静态资源分发。

---

## 11. 后续可扩展方向

- 多语言支持；
- 菜谱推荐系统（基于用户偏好）；
- 食材识别（OCR + 图像识别）；
- 接入语音助手与智能硬件；

---

本架构设计文档为系统设计、开发、测试及后期运维提供技术依据。如后续架构有调整，将在版本管理平台同步更新。
