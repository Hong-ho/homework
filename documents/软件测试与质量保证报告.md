# 软件测试与质量保证报告

## 项目名称：AI 菜谱生成系统

---

## 一、报告目的

本报告旨在评估 AI 菜谱生成系统的主要功能模块的可靠性、稳定性和健壮性，明确测试覆盖范围与测试策略，保障用户操作过程中数据正确性与功能一致性。系统测试将聚焦于：

- 用户登录注册功能
- 菜谱生成流程完整性
- 图像处理与图像文件保存流程
- 用户历史与收藏机制的准确性
- 边界与异常情况的处理能力

---

## 二、测试策略与测试类型

### 2.1 测试目标

- 覆盖各个类（`login`、`User`、`RecipeGenerationPipeline`、`Recipe`）的主要方法
- 验证图像生成函数（如 `generate_dish_image`）的图像保存与格式正确性
- 测试用户数据的增删改查流程是否正确持久化
- 验证系统是否能在异常输入下做出合理响应

### 2.2 测试类型

| 测试类型 | 说明 |
|----------|------|
| 单元测试 | 测试各类中函数的逻辑正确性和输出一致性 |
| 集成测试 | 测试如菜谱生成流水线中多个模块协同工作流程 |
| 功能测试 | 确认输入输出是否符合功能需求文档的描述 |
| 异常测试 | 测试错误数据、文件缺失、无网络等极端情况 |
| 边界测试 | 验证最小/最大输入量或空输入对系统影响 |
| 回归测试 | 功能变更或修复后重新测试原有功能 |

---

## 三、测试环境

- 操作系统：Windows/Linux/macOS
- 编程语言：Python 3.x
- Web 框架：Flask
- 图像库：Pillow (PIL)
- 测试工具：pytest、unittest、Postman
- 文件结构约定：图片保存在 `./pictures/`，用户数据以 JSON 文件保存

---

## 四、各模块测试用例设计

### 4.1 login 类测试

负责注册、认证与用户加载。

| 用例编号 | 测试点 | 输入 | 预期输出 |
|----------|--------|------|----------|
| L-01 | 正常登录 | 正确用户名密码 | 返回 True，User 实例已加载 |
| L-02 | 错误密码 | 正确用户名 + 错密码 | 返回 False |
| L-03 | 注册新用户 | 新用户名 + 密码 | 成功创建用户目录与数据文件 |
| L-04 | 用户不存在 | 不存在用户名 | 返回 False，User 属性为 None |

---

### 4.2 User 类测试

负责收藏、历史记录与偏好数据的管理。

| 用例编号 | 测试点 | 操作 | 预期输出 |
|----------|--------|------|----------|
| U-01 | 加载历史记录 | load_user_history() | 正确读取 JSON 数据为列表 |
| U-02 | 添加收藏 | save_recipe_to_likes(recipe) | 文件夹更新 + 喜好数据更新 |
| U-03 | 删除收藏 | 移除文件 + reload likes | 收藏列表减少一项 |
| U-04 | 偏好更新 | generate_preferences() | 返回非空字典并写入文件 |
| U-05 | 初次创建用户 | setup() | 正确创建 likes/history 文件夹 |

---

### 4.3 RecipeGenerationPipeline 类测试

负责整个生成流程，从文本到图像再到营养数据。

| 用例编号 | 测试点 | 输入 | 预期输出 |
|----------|--------|------|----------|
| R-01 | 正常流程 | 合理的 ingredients + cuisine | 返回完整 Recipe 实例 |
| R-02 | 空输入 | 空 ingredients | 返回错误提示字典 |
| R-03 | 用户偏好参与 | 设置 preferences | 食谱倾向应有所体现（手动检查） |
| R-04 | UML 图生成失败 | 模拟子模块异常 | 返回错误字典，流程不中断 |
| R-05 | 图像转 Base64 | image_to_base64(image) | 返回 Base64 编码字符串 |

---

### 4.4 Recipe 类测试

封装结果结构，方便序列化与展示。

| 用例编号 | 测试点 | 操作 | 预期输出 |
|----------|--------|------|----------|
| RC-01 | 转字典 | to_dict() | 返回完整字段的字典 |
| RC-02 | 字段一致性 | Recipe(...).to_dict() | 包含 name、步骤、图片、UML、营养字段 |

---

### 4.5 generate_dish_image 函数测试

| 用例编号 | 测试点 | 输入 | 预期输出 |
|----------|--------|------|----------|
| GDI-01 | 正常描述生成图像 | 含 style, ingredients_visual 等字段的 dict | 返回 Image 对象，文件写入成功 |
| GDI-02 | 输入缺字段 | 缺少 'style' 或 'sauce_gloss' | 触发异常或记录失败 |
| GDI-03 | 图像是否可展示 | 返回的对象是否为 PIL.Image | True |
| GDI-04 | 图像保存检查 | 保存路径是否为 ./pictures/dish_image.png | 文件存在 |

---

## 五、接口测试设计（Flask 路由）

### POST /generate

- 输入：{"ingredients": [...], "cuisine": "..."}
- 输出：包含菜谱名、步骤列表、主图路径、步骤图路径、营养分析等字段
- 异常情况：输入为空返回错误提示；图像失败返回替代信息

### POST /login, /register

- 输入：{"username": ..., "password": ...}
- 输出：登录状态 True/False；注册成功或失败提示

### GET /get_history, /get_collect

- 验证是否返回与本地 JSON 文件内容一致
- 确认排序、新增项是否按时间更新

---

## 六、异常与边界测试

| 模块 | 异常情况 | 系统响应 |
|------|----------|----------|
| login | 用户文件损坏 | 捕获异常并提示用户 |
| RecipePipeline | 图片生成接口失败 | 跳过该步骤但不中断主流程 |
| User | 用户无收藏 | 返回空列表 |
| generate_dish_image | 无效描述字段 | 捕获 KeyError 并记录日志 |

---

## 七、质量保证机制

### 7.1 代码规范

- 所有函数包含 docstring
- 类的结构职责单一、方法清晰
- 图片统一存储路径，便于维护与清理

### 7.2 模块解耦与可测试性

- 每个功能模块（如登录、图像、偏好分析）封装良好
- 流水线设计利于整体流程测试与单步调试

### 7.3 文件管理策略

- 所有图像写入固定路径并具命名规范
- 所有用户数据（包括历史、偏好、收藏）存为 JSON，结构可读

### 7.4 测试覆盖度保障

- 所有主要类与函数均具备测试计划
- 尽可能覆盖到用户操作路径的所有中间状态

---

## 八、结论与建议

本系统核心模块职责清晰、可测试性良好、功能流程完整。测试策略覆盖了从单元到集成的完整生命周期。

未来建议：

- 将测试用例实现为 `pytest` 自动化脚本并集成 CI/CD
- 所有生成图片应加入哈希命名，避免文件覆盖
- 增加图像生成异常的日志记录与自动重试机制
- 引入 mock 模拟图像生成与 API 结果提升测试效率

---

*报告基于系统设计图、类说明与当前模块功能推导，如功能扩展请持续更新测试策略与覆盖范围。*
