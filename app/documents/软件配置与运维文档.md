# 智能菜谱生成系统 - 软件配置与运维文档

---

## 1. 文档目的

本文档用于指导开发者或运维人员在不同环境中正确部署、配置和维护智能菜谱生成系统，确保系统稳定运行，支持后续迭代。

---

## 2. 运行环境说明

### 2.1 系统环境

| 项目           | 版本建议         |
|----------------|------------------|
| 操作系统       | Ubuntu 20.04+ / Windows 10+ |
| Python         | Python 3.9+       |
| Node.js（如需构建前端） | v16+     |
| 浏览器         | Chrome / Edge     |
| 容器支持（可选）| Docker 20.10+     |

### 2.2 硬件建议

| 组件           | 最低配置           | 推荐配置         |
|----------------|--------------------|------------------|
| 内存           | ≥ 4GB              | ≥ 8GB            |
| 存储空间       | ≥ 5GB 可用空间     | ≥ 20GB           |
| GPU（可选）    | 无 / 任意独显      | NVIDIA RTX 20XX+ |

---

## 3. 安装依赖

### 3.1 创建虚拟环境（推荐）

```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate     # Windows
```

### 3.2 安装依赖包

`requirements.txt` 文件已保存在同目录下，执行以下命令安装：

```bash
pip install -r requirements.txt
```

> 如需更换镜像源（如清华源）：

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## 4. 项目结构概览

```
app/
├── classes/            # 模型与数据结构
├── data/               # 用户数据与缓存
├── documents/          # 文档与UMLS工具
├── static/             # 静态文件（JS、CSS）
├── templates/          # 前端模板
├── utils/              # 工具函数与辅助逻辑
├── __pycache__/        # 缓存
├── requirements.txt    # 依赖清单
├── main.py             # 启动入口
└── ...（其他模块）
```

---

## 5. 启动与部署

### 5.1 启动开发服务（本地）

```bash
python main.py
```

默认监听：`http://127.0.0.1:5000`

### 5.2 使用Docker部署（可选）

```bash
docker build -t recipe-ai .
docker run -d -p 5000:5000 recipe-ai
```

---

## 6. 前端部署说明（可选）

如果前后端分离，可使用如下命令构建：

```bash
npm install
npm run build
```

构建后的文件放置于 `static/` 和 `templates/` 目录中，或部署至独立前端服务器（如Vite/Vercel）。

---

## 7. 数据库配置（默认）

- 默认使用 **SQLite**，文件位于 `data/` 目录。
- 如需替换为 PostgreSQL/MySQL，请：
  - 修改 `.env` 或配置项
  - 安装对应驱动
  - 更新连接字符串

---

## 8. 运维建议

### 8.1 日志记录

- 默认输出至控制台
- 可扩展为文件日志/云日志（如 Loguru、Sentry）

### 8.2 自动重启机制

推荐使用：

- `pm2`（Node/前端）
- `supervisor`（后端）
- `systemd`（Linux）

### 8.3 监控与告警

- 结合 Prometheus + Grafana 进行性能监控
- 可设置 404 / 500 报错告警邮件或Webhook通知

---

## 9. 常见问题与解决方案

| 问题                                      | 可能原因与解决办法                                                                 |
|-------------------------------------------|-------------------------------------------------------------------------------------|
| 启动后访问不了页面                         | 检查是否监听本地IP (`127.0.0.1`) 或端口占用                                         |
| 图像生成失败                               | 确认是否正确连接图像生成API / 本地模型路径正确                                     |
| 模型响应慢                                 | 建议缓存重复请求结果或启用异步任务队列（如 Celery）                                 |
| `ModuleNotFoundError`                     | 未激活虚拟环境或依赖未正确安装，重新执行 pip 安装                                   |
| `PermissionError` / `EACCES` 权限问题     | 使用管理员权限或检查文件系统读写权限                                               |

---

## 10. 文件备份与更新建议

- 每周自动备份：
  - `data/user_data/`
  - `documents/`
  - 数据库文件（如 `data/recipe.db`）
- 更新流程建议：
  1. 使用Git拉取更新代码
  2. 在测试环境中验证功能
  3. 执行热更新或重启服务

---

## 11. 结束语

本配置与运维文档将持续维护，建议每次系统更新时同步修订。请所有开发与维护人员定期检查依赖项与运行状态，确保系统稳定运行。
